<div class="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700 relative">
  <header class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-black dark:text-white tracking-tighter uppercase italic tracking-widest">Mission Control</h1>
      <p class="text-slate-500 dark:text-slate-400 font-medium tracking-tight">Deploying autonomous operations across the squad.</p>
    </div>
    <button (click)="openCreateModal()" class="bg-brand-primary text-white px-8 py-4 rounded-[1.5rem] font-black text-[10px] uppercase tracking-widest shadow-2xl shadow-indigo-500/40 hover:scale-105 active:scale-95 transition-all">
      Create Task
    </button>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6" cdkDropListGroup>
    
    <!-- Todo Column -->
    <div class="flex flex-col gap-4">
      <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 px-4">Backlog ({{todo.length}})</h3>
      <div
        id="todo-list"
        cdkDropList
        [cdkDropListData]="todo"
        class="min-h-[600px] bg-slate-100/30 dark:bg-white/[0.01] rounded-[2.5rem] p-4 flex flex-col gap-4 border border-dashed border-slate-200 dark:border-white/5"
        (cdkDropListDropped)="drop($event)">
        
        <div *ngFor="let task of todo" cdkDrag (dblclick)="openEditModal(task)" 
             class="p-8 glass rounded-[2rem] border border-slate-200 dark:border-white/5 space-y-4 cursor-grab active:cursor-grabbing hover:border-brand-primary/50 transition-all group shadow-sm hover:shadow-xl">
          <div class="flex justify-between items-start">
            <span [class]="'text-[8px] font-black uppercase tracking-[0.2em] px-2 py-1 rounded-lg ' + getPriorityClass(task.priority)">
              {{task.priority}}
            </span>
            <span class="text-2xl">{{getAgentEmoji(task.target_agent)}}</span>
          </div>
          <h4 class="font-black dark:text-white leading-tight uppercase tracking-tight italic">{{task.title}}</h4>
          <p class="text-[11px] text-slate-500 dark:text-slate-400 line-clamp-3 leading-relaxed">{{task.description}}</p>
        </div>
      </div>
    </div>

    <!-- In Progress Column -->
    <div class="flex flex-col gap-4">
      <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-orange-500 px-4 italic">Executing ({{inProgress.length}})</h3>
      <div
        id="progress-list"
        cdkDropList
        [cdkDropListData]="inProgress"
        class="min-h-[600px] bg-slate-100/30 dark:bg-white/[0.01] rounded-[2.5rem] p-4 flex flex-col gap-4 border border-dashed border-slate-200 dark:border-white/5"
        (cdkDropListDropped)="drop($event)">
        
        <div *ngFor="let task of inProgress" cdkDrag (dblclick)="openEditModal(task)"
             class="p-8 glass rounded-[2rem] border border-slate-200 dark:border-white/5 space-y-4 cursor-grab active:cursor-grabbing hover:border-orange-500/50 transition-all group border-l-4 border-l-orange-500 shadow-sm hover:shadow-xl">
          <div class="flex justify-between items-start">
            <span [class]="'text-[8px] font-black uppercase tracking-[0.2em] px-2 py-1 rounded-lg ' + getPriorityClass(task.priority)">
              {{task.priority}}
            </span>
            <div class="flex items-center gap-2">
               <div class="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse"></div>
               <span class="text-2xl">{{getAgentEmoji(task.target_agent)}}</span>
            </div>
          </div>
          <h4 class="font-black dark:text-white leading-tight uppercase tracking-tight italic">{{task.title}}</h4>
          <p class="text-[11px] text-slate-500 dark:text-slate-400 line-clamp-3 leading-relaxed">{{task.description}}</p>
        </div>
      </div>
    </div>

    <!-- Review Column -->
    <div class="flex flex-col gap-4">
      <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-indigo-500 px-4 italic">Validating ({{review.length}})</h3>
      <div
        id="review-list"
        cdkDropList
        [cdkDropListData]="review"
        class="min-h-[600px] bg-slate-100/30 dark:bg-white/[0.01] rounded-[2.5rem] p-4 flex flex-col gap-4 border border-dashed border-slate-200 dark:border-white/5"
        (cdkDropListDropped)="drop($event)">
        
        <div *ngFor="let task of review" cdkDrag (dblclick)="openEditModal(task)"
             class="p-8 glass rounded-[2rem] border border-slate-200 dark:border-white/5 space-y-4 cursor-grab active:cursor-grabbing hover:border-indigo-500/50 transition-all group border-l-4 border-l-indigo-500 shadow-sm hover:shadow-xl">
          <div class="flex justify-between items-start">
            <span [class]="'text-[8px] font-black uppercase tracking-[0.2em] px-2 py-1 rounded-lg ' + getPriorityClass(task.priority)">
              {{task.priority}}
            </span>
            <span class="text-2xl">{{getAgentEmoji(task.target_agent)}}</span>
          </div>
          <h4 class="font-black dark:text-white leading-tight uppercase tracking-tight italic">{{task.title}}</h4>
          <p class="text-[11px] text-slate-500 dark:text-slate-400 line-clamp-3 leading-relaxed">{{task.description}}</p>
        </div>
      </div>
    </div>

    <!-- Done Column -->
    <div class="flex flex-col gap-4">
      <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-green-500 px-4 italic">Archived ({{done.length}})</h3>
      <div
        id="done-list"
        cdkDropList
        [cdkDropListData]="done"
        class="min-h-[600px] bg-slate-100/30 dark:bg-white/[0.01] rounded-[2.5rem] p-4 flex flex-col gap-4 border border-dashed border-slate-200 dark:border-white/5"
        (cdkDropListDropped)="drop($event)">
        
        <div *ngFor="let task of done" cdkDrag (dblclick)="openEditModal(task)"
             class="p-8 glass rounded-[2rem] border border-slate-200 dark:border-white/5 space-y-4 cursor-grab active:cursor-grabbing hover:border-green-500/50 transition-all group border-l-4 border-l-green-500 opacity-40 hover:opacity-100 shadow-sm">
          <div class="flex justify-between items-start">
            <span class="text-[8px] font-black uppercase tracking-[0.2em] px-2 py-1 rounded-lg bg-green-500/10 text-green-500">
              Completed
            </span>
            <span class="text-2xl">{{getAgentEmoji(task.target_agent)}}</span>
          </div>
          <h4 class="font-black dark:text-white leading-tight uppercase tracking-tight italic line-through">{{task.title}}</h4>
        </div>
      </div>
    </div>

  </div>

  <!-- Task Modal -->
  <div *ngIf="isModalOpen()" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-in fade-in duration-300">
    <div class="max-w-2xl w-full glass rounded-[2.5rem] border border-white/10 p-10 space-y-8 shadow-2xl relative overflow-hidden">
      <div class="absolute top-0 right-0 p-6">
        <button (click)="closeModal()" class="text-slate-500 hover:text-white">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>

      <header>
        <h2 class="text-2xl font-black dark:text-white tracking-tighter uppercase italic">{{ isEditMode() ? 'Update Neural Protocol' : 'Initialize New Mission' }}</h2>
        <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-1">Assigning operational parameters to the Squad.</p>
      </header>

      <form [formGroup]="taskForm" (ngSubmit)="saveTask()" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2">Task Title</label>
            <input formControlName="title" placeholder="Protocol Name..." 
                   class="w-full bg-slate-100 dark:bg-white/5 border border-transparent dark:border-white/5 rounded-2xl px-6 py-4 text-sm font-bold dark:text-white focus:border-brand-primary outline-none transition-all">
          </div>
          <div class="space-y-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2">Assign Agent</label>
            <select formControlName="target_agent" class="w-full bg-slate-100 dark:bg-white/5 border border-transparent dark:border-white/5 rounded-2xl px-6 py-4 text-sm font-bold dark:text-white focus:border-brand-primary outline-none transition-all appearance-none cursor-pointer">
              <option value="claw">üëë CLAW (ADMIN)</option>
              <option value="bar">üèóÔ∏è BAR (DEV)</option>
              <option value="noma">üîç NOMA (RESEARCH)</option>
              <option value="naji">üìÖ NAJI (ASSISTANT)</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2">Priority Level</label>
            <select formControlName="priority" class="w-full bg-slate-100 dark:bg-white/5 border border-transparent dark:border-white/5 rounded-2xl px-6 py-4 text-sm font-bold dark:text-white focus:border-brand-primary outline-none transition-all appearance-none cursor-pointer">
              <option value="low">LOW PRIORITY</option>
              <option value="medium">MEDIUM PRIORITY</option>
              <option value="high">HIGH PRIORITY</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2">Internal Message</label>
            <input formControlName="message" placeholder="Directive for the bot..." 
                   class="w-full bg-slate-100 dark:bg-white/5 border border-transparent dark:border-white/5 rounded-2xl px-6 py-4 text-sm font-bold dark:text-white focus:border-brand-primary outline-none transition-all">
          </div>
        </div>

        <div class="space-y-2">
          <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2">Operational Description</label>
          <textarea formControlName="description" rows="4" placeholder="Detailed mission parameters..." 
                    class="w-full bg-slate-100 dark:bg-white/5 border border-transparent dark:border-white/5 rounded-3xl px-6 py-6 text-sm font-medium dark:text-white focus:border-brand-primary outline-none transition-all resize-none"></textarea>
        </div>

        <button type="submit" [disabled]="taskForm.invalid" 
                class="w-full py-5 rounded-[1.5rem] bg-brand-primary text-white font-black text-[10px] uppercase tracking-[0.3em] shadow-2xl shadow-indigo-500/40 hover:brightness-110 active:scale-[0.98] transition-all disabled:opacity-30 disabled:cursor-not-allowed">
          {{ isEditMode() ? 'Commit Update' : 'Initialize Mission' }}
        </button>
      </form>
    </div>
  </div>
</div>
